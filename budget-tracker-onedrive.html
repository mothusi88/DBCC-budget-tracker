<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBCC Budget Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f8f9fa;
            color: #212529;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        .header-left h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 0.25rem;
        }

        .header-left p {
            color: #6c757d;
            font-size: 0.95rem;
        }

        .header-right {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #1e3a8a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #495057;
            border: 2px solid #dee2e6;
        }

        .btn-secondary:hover {
            border-color: #1e40af;
            color: #1e40af;
        }

        .btn-success {
            background: #10b981;
            color: white;
            font-size: 1rem;
            padding: 0.875rem 1.75rem;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }

        /* Stats Cards */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .stat-label {
            font-size: 0.85rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e40af;
        }

        /* Add Expense Section */
        .add-expense-section {
            background: white;
            padding: 1.25rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 2px solid #1e40af;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .add-expense-section-left h2 {
            color: #1e40af;
            font-size: 1.15rem;
            margin-bottom: 0.25rem;
            text-align: left;
        }

        .add-expense-section-left p {
            color: #6c757d;
            margin-bottom: 0;
            font-size: 0.9rem;
            text-align: left;
        }

        /* Main Content Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Card */
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #212529;
        }

        /* Level 1 - Main Categories */
        .category-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .category-item {
            padding: 1.25rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-item:hover {
            border-color: #1e40af;
            background: #f8f9ff;
        }

        .category-item.expanded {
            background: #f8f9ff;
            border-color: #1e40af;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-name {
            font-weight: 600;
            font-size: 1.05rem;
            color: #212529;
        }

        .category-amount {
            font-weight: 700;
            font-size: 1.15rem;
            color: #1e40af;
        }

        .category-progress {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 0.75rem 0;
            overflow: hidden;
        }

        .category-progress-bar {
            height: 100%;
            background: #1e40af;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .category-progress-bar.warning { background: #f59e0b; }
        .category-progress-bar.danger { background: #ef4444; }

        .category-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }

        .variance-positive { color: #10b981; font-weight: 600; }
        .variance-negative { color: #ef4444; font-weight: 600; }

        /* Level 2 - Sub Categories */
        .sub-categories {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
        }

        .sub-category-item {
            padding: 1rem;
            background: #f8f9ff;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sub-category-item:hover {
            border-color: #1e40af;
            background: #eff6ff;
        }

        .sub-category-item.expanded {
            border-color: #1e40af;
            background: #eff6ff;
        }

        .sub-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .sub-category-name {
            font-weight: 600;
            color: #1e40af;
            font-size: 0.95rem;
        }

        .sub-category-amount {
            font-weight: 600;
            color: #212529;
        }

        .sub-category-progress {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            margin: 0.5rem 0;
            overflow: hidden;
        }

        .sub-category-progress-bar {
            height: 100%;
            background: #1e40af;
            border-radius: 2px;
            transition: width 0.3s;
        }

        .sub-category-progress-bar.warning { background: #f59e0b; }
        .sub-category-progress-bar.danger { background: #ef4444; }

        .sub-category-stats {
            font-size: 0.85rem;
            color: #6c757d;
        }

        /* Level 3 - Individual Items */
        .level3-items {
            margin-top: 0.75rem;
            padding-left: 1rem;
            border-left: 3px solid #cbd5e1;
        }

        .item {
            padding: 0.75rem;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .item-name {
            font-size: 0.9rem;
            color: #495057;
            font-weight: 500;
        }

        .item-amount {
            font-weight: 600;
            color: #212529;
            font-size: 0.9rem;
        }

        .item-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        .item-notes {
            font-size: 0.8rem;
            color: #6c757d;
            font-style: italic;
            margin-top: 0.25rem;
            padding-top: 0.25rem;
            border-top: 1px dashed #e9ecef;
        }

        /* Activity Log */
        .activity-log {
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 1rem;
            border-left: 3px solid #1e40af;
            background: #f8f9ff;
            border-radius: 6px;
            margin-bottom: 0.75rem;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .activity-user {
            font-weight: 600;
            color: #1e40af;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .activity-category {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        .activity-description {
            font-size: 0.95rem;
            color: #495057;
            margin-bottom: 0.25rem;
        }

        .activity-amount {
            font-weight: 700;
            color: #ef4444;
        }

        .activity-actions {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .btn-delete {
            padding: 0.375rem 0.75rem;
            background: #fff;
            color: #ef4444;
            border: 1px solid #ef4444;
            font-size: 0.85rem;
        }

        .btn-delete:hover {
            background: #ef4444;
            color: white;
        }

        /* Budget Period Selector */
        .budget-period-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            background: white;
            padding: 0.5rem;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .period-label {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 600;
        }

        .period-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #e9ecef;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .period-btn:hover {
            border-color: #1e40af;
            color: #1e40af;
        }

        .period-btn.active {
            background: #1e40af;
            color: white;
            border-color: #1e40af;
        }

        .btn-add-item {
            padding: 0.5rem 1rem;
            background: white;
            color: #6c757d;
            border: 1px dashed #cbd5e1;
            font-size: 0.85rem;
        }

        .btn-add-item:hover {
            border-color: #1e40af;
            color: #1e40af;
            border-style: solid;
        }

        /* Item notes - expanded view */
        .item-notes-full {
            font-size: 0.85rem;
            color: #495057;
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #1e40af;
        }

        .setup-budget-input {
            width: 150px;
            padding: 0.5rem;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-weight: 600;
            transition: border-color 0.2s;
        }

        .setup-budget-input:focus {
            outline: none;
            border-color: #1e40af;
        }

        .setup-delete-btn {
            padding: 0.4rem 0.6rem;
            background: white;
            border: 1px solid #ef4444;
            color: #ef4444;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .setup-delete-btn:hover {
            background: #ef4444;
            color: white;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #212529;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #1e40af;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal-actions .btn {
            flex: 1;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: #10b981;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const MSAL_CONFIG = {
            auth: {
                clientId: '642e1f35-d45f-47d7-97fd-bb6bf64ff6e5',
                authority: 'https://login.microsoftonline.com/common',
                redirectUri: window.location.origin + window.location.pathname
            },
            cache: { cacheLocation: 'localStorage' }
        };

        function BudgetTrackerApp() {
            const [isSignedIn, setIsSignedIn] = useState(false);
            const [msalInstance, setMsalInstance] = useState(null);
            const [budgets, setBudgets] = useState([]);
            const [activities, setActivities] = useState([]);
            const [expandedCategory, setExpandedCategory] = useState(null);
            const [expandedSubCategory, setExpandedSubCategory] = useState(null);
            const [showExpenseModal, setShowExpenseModal] = useState(false);
            const [showSetupModal, setShowSetupModal] = useState(false);
            const [showAddItemModal, setShowAddItemModal] = useState(false);
            const [notification, setNotification] = useState(null);
            const [currentPeriod, setCurrentPeriod] = useState('2024-25');
            const [budgetPeriods] = useState(['2022-23', '2023-24', '2024-25', '2025-26']);
            const [setupYearData, setSetupYearData] = useState([]);
            const [newFiscalYear, setNewFiscalYear] = useState('');

            const [expenseForm, setExpenseForm] = useState({
                userName: '',
                mainCategory: '',
                mainCategoryId: null,
                subCategory: '',
                subCategoryId: null,
                item: '',
                description: '',
                amount: ''
            });

            const [addItemForm, setAddItemForm] = useState({
                level: '1', // 1=main category, 2=sub-category, 3=item
                mainCategoryId: null,
                subCategoryId: null,
                code: '',
                name: '',
                budget: '',
                notes: ''
            });

            useEffect(() => {
                initializeMsal();
            }, []);

            const initializeMsal = async () => {
                const msalInstance = new window.msal.PublicClientApplication(MSAL_CONFIG);
                await msalInstance.initialize();
                setMsalInstance(msalInstance);

                const accounts = msalInstance.getAllAccounts();
                if (accounts.length > 0) {
                    setIsSignedIn(true);
                    loadSampleData();
                }
            };

            const signIn = async () => {
                try {
                    const response = await msalInstance.loginPopup({
                        scopes: ['Files.ReadWrite', 'User.Read']
                    });
                    setIsSignedIn(true);
                    loadSampleData();
                } catch (error) {
                    alert('Sign-in failed: ' + error.message);
                }
            };

            const signOut = () => {
                msalInstance.logout();
            };

            const loadSampleData = () => {
                // Load budget data with 3-level hierarchy
                setBudgets([
                    {
                        id: 1,
                        code: 'A14',
                        name: 'Staff Costs - Indirect',
                        totalAmount: 3297995,
                        spentAmount: 84785,
                        subCategories: [
                            {
                                id: 1,
                                code: '2127',
                                name: 'BOCRA Social Activities',
                                totalAmount: 150000,
                                spentAmount: 80785,
                                items: []
                            },
                            {
                                id: 2,
                                code: '2128',
                                name: 'Staff uniform',
                                totalAmount: 1684537,
                                spentAmount: 0,
                                items: []
                            },
                            {
                                id: 3,
                                code: '2132',
                                name: 'Subscriptions to professional memberships',
                                totalAmount: 13308,
                                spentAmount: 3200,
                                items: []
                            }
                        ]
                    },
                    {
                        id: 2,
                        code: 'A15',
                        name: 'Training',
                        totalAmount: 469189,
                        spentAmount: 124318.59,
                        subCategories: []
                    },
                    {
                        id: 3,
                        code: 'A16',
                        name: 'Operating costs',
                        totalAmount: 16160398,
                        spentAmount: 1185701.66,
                        subCategories: [
                            {
                                id: 1,
                                code: '2134',
                                name: 'Entertainment',
                                totalAmount: 20000,
                                spentAmount: 0,
                                items: []
                            },
                            {
                                id: 2,
                                code: '3150',
                                name: 'Consultancies',
                                totalAmount: 4604133,
                                spentAmount: 689527.94,
                                items: [
                                    { 
                                        id: 1,
                                        name: 'Consumer/operator Perception Survey', 
                                        budget: 380133, 
                                        spent: 444708.3,
                                        notes: '64,575 to be sourced from the BOCRA Contingency'
                                    },
                                    { 
                                        id: 2,
                                        name: 'Outsourcing PR Events', 
                                        budget: 2000000, 
                                        spent: 0,
                                        notes: ''
                                    },
                                    { 
                                        id: 3,
                                        name: 'Elections Monitoring and Training of Broadcasters', 
                                        budget: 500000, 
                                        spent: 15250,
                                        notes: 'costs for Elections code of conduct training for Politicians'
                                    },
                                    { 
                                        id: 4,
                                        name: 'Consumer Coverage FM Monitoring', 
                                        budget: 224000, 
                                        spent: 28140,
                                        notes: ''
                                    },
                                    { 
                                        id: 5,
                                        name: 'Maintenance of the Broadcast Monitoring System', 
                                        budget: 1500000, 
                                        spent: 201419.64,
                                        notes: ''
                                    }
                                ]
                            },
                            {
                                id: 3,
                                code: '3160',
                                name: 'Conferences hosted by BOCRA',
                                totalAmount: 2124172,
                                spentAmount: 424123.36,
                                items: [
                                    { 
                                        id: 1,
                                        name: 'IIC', 
                                        budget: 250000, 
                                        spent: 118620,
                                        notes: 'Dato Seiko, Mmokolodi and Interpretation'
                                    },
                                    { 
                                        id: 2,
                                        name: 'National Broadcasting Conference', 
                                        budget: 340000, 
                                        spent: 305503.36,
                                        notes: 'registration booth, videography, evaluation meeting lunch'
                                    },
                                    { 
                                        id: 3,
                                        name: 'Benchmarking Exercises', 
                                        budget: 66000, 
                                        spent: 0,
                                        notes: 'NAM, MOM, LCA'
                                    },
                                    { 
                                        id: 4,
                                        name: 'Cyber Security Workshops', 
                                        budget: 176000, 
                                        spent: 0,
                                        notes: 'We can move the media training to here'
                                    },
                                    { 
                                        id: 5,
                                        name: 'Annual Cyber Drill', 
                                        budget: 176000, 
                                        spent: 0,
                                        notes: ''
                                    },
                                    { 
                                        id: 6,
                                        name: 'IPv6 Workshops', 
                                        budget: 176000, 
                                        spent: 0,
                                        notes: ''
                                    },
                                    { 
                                        id: 7,
                                        name: 'WTSA Workshops', 
                                        budget: 100000, 
                                        spent: 0,
                                        notes: 'Held 7 May'
                                    },
                                    { 
                                        id: 8,
                                        name: 'CRASA, EXCO and Committees', 
                                        budget: 550000, 
                                        spent: 0,
                                        notes: ''
                                    }
                                ]
                            },
                            {
                                id: 4,
                                code: '3170',
                                name: 'Conferences',
                                totalAmount: 525673.55,
                                spentAmount: 0,
                                items: [
                                    { id: 1, name: 'IIC', budget: 126052.66, spent: 0, notes: '' },
                                    { id: 2, name: 'Next TV Series', budget: 99142.86, spent: 0, notes: 'Used by the Certificate in Corporate Communication' },
                                    { id: 3, name: 'Africast', budget: 61761.54, spent: 0, notes: '' },
                                    { id: 4, name: 'International Association of Media & Comms Research', budget: 25000, spent: 0, notes: '' }
                                ]
                            }
                        ]
                    }
                ]);

                setActivities([
                    {
                        id: 1,
                        timestamp: new Date().toISOString(),
                        userName: 'Keotshepile M.',
                        mainCategory: 'A16 - Operating costs',
                        subCategory: '3150 - Consultancies',
                        item: 'Consumer/operator Perception Survey',
                        amount: 444708.30
                    },
                    {
                        id: 2,
                        timestamp: new Date(Date.now() - 86400000).toISOString(),
                        userName: 'Mothusi M.',
                        mainCategory: 'A16 - Operating costs',
                        subCategory: '3160 - Conferences hosted by BOCRA',
                        item: 'IIC',
                        amount: 118620
                    }
                ]);
            };

            const formatCurrency = (amount) => {
                return `P ${amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            };

            const formatTime = (timestamp) => {
                const date = new Date(timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                const diffHours = Math.floor(diffMins / 60);
                if (diffHours < 24) return `${diffHours}h ago`;
                return date.toLocaleDateString();
            };

            const calculateStats = () => {
                const totalBudget = budgets.reduce((sum, b) => sum + b.totalAmount, 0);
                const totalSpent = budgets.reduce((sum, b) => sum + b.spentAmount, 0);
                const totalRemaining = totalBudget - totalSpent;
                return { totalBudget, totalSpent, totalRemaining };
            };

            const getProgressColor = (percentage) => {
                if (percentage >= 90) return 'danger';
                if (percentage >= 75) return 'warning';
                return '';
            };

            const showNotification = (message) => {
                setNotification(message);
                setTimeout(() => setNotification(null), 3000);
            };

            const handleAddExpense = (e) => {
                e.preventDefault();
                
                // In real implementation, this would write to OneDrive Excel
                const newActivity = {
                    id: activities.length + 1,
                    timestamp: new Date().toISOString(),
                    userName: expenseForm.userName,
                    mainCategory: expenseForm.mainCategory,
                    subCategory: expenseForm.subCategory,
                    item: expenseForm.item,
                    amount: parseFloat(expenseForm.amount),
                    type: 'expense'
                };

                setActivities([newActivity, ...activities]);
                showNotification('Expense recorded successfully!');
                setShowExpenseModal(false);
                setExpenseForm({
                    userName: '',
                    mainCategory: '',
                    mainCategoryId: null,
                    subCategory: '',
                    subCategoryId: null,
                    item: '',
                    description: '',
                    amount: ''
                });
            };

            const handleDeleteRecord = (activityId) => {
                const activity = activities.find(a => a.id === activityId);
                if (!activity) return;

                if (confirm(`Are you sure you want to delete this ${formatCurrency(activity.amount)} expense?`)) {
                    // Create deletion log entry
                    const deletionLog = {
                        id: activities.length + 1,
                        timestamp: new Date().toISOString(),
                        userName: 'System',
                        mainCategory: activity.mainCategory,
                        subCategory: activity.subCategory,
                        item: activity.item,
                        amount: activity.amount,
                        type: 'deletion',
                        deletedBy: 'Current User' // In real app, get from MSAL
                    };

                    // Remove the activity and add deletion log
                    setActivities([deletionLog, ...activities.filter(a => a.id !== activityId)]);
                    showNotification('Record deleted and logged');
                }
            };

            const handleAddBudgetItem = (e) => {
                e.preventDefault();
                
                // In real implementation, this would write to OneDrive Excel
                showNotification('Budget item would be added to Excel here');
                setShowAddItemModal(false);
                setAddItemForm({
                    level: '1',
                    mainCategoryId: null,
                    subCategoryId: null,
                    code: '',
                    name: '',
                    budget: '',
                    notes: ''
                });
            };

            const openSetupNewYear = () => {
                // Deep clone current budget data to prefill the setup
                const clonedData = JSON.parse(JSON.stringify(budgets));
                setSetupYearData(clonedData);
                setNewFiscalYear('2025-26'); // Default next year
                setShowSetupModal(true);
            };

            const handleSetupYearSubmit = () => {
                // In real implementation, this would create new Excel sheet with this data
                showNotification(`Budget for FY ${newFiscalYear} would be created in Excel`);
                setShowSetupModal(false);
            };

            const updateSetupBudgetAmount = (mainId, subId, itemId, newAmount) => {
                const updated = [...setupYearData];
                const mainCat = updated.find(m => m.id === mainId);
                if (!mainCat) return;

                if (subId === null) {
                    // Update main category
                    mainCat.totalAmount = parseFloat(newAmount) || 0;
                } else {
                    const subCat = mainCat.subCategories.find(s => s.id === subId);
                    if (!subCat) return;

                    if (itemId === null) {
                        // Update sub-category
                        subCat.totalAmount = parseFloat(newAmount) || 0;
                    } else {
                        // Update item
                        const item = subCat.items.find(i => i.id === itemId);
                        if (item) {
                            item.budget = parseFloat(newAmount) || 0;
                        }
                    }
                }
                setSetupYearData(updated);
            };

            const deleteSetupItem = (mainId, subId, itemId) => {
                const updated = [...setupYearData];
                const mainCat = updated.find(m => m.id === mainId);
                if (!mainCat) return;

                if (subId === null) {
                    // Delete main category
                    const filtered = updated.filter(m => m.id !== mainId);
                    setSetupYearData(filtered);
                } else if (itemId === null) {
                    // Delete sub-category
                    mainCat.subCategories = mainCat.subCategories.filter(s => s.id !== subId);
                    setSetupYearData(updated);
                } else {
                    // Delete item
                    const subCat = mainCat.subCategories.find(s => s.id === subId);
                    if (subCat) {
                        subCat.items = subCat.items.filter(i => i.id !== itemId);
                        setSetupYearData(updated);
                    }
                }
            };

            const getSubCategoriesForMain = () => {
                if (!expenseForm.mainCategoryId) return [];
                const mainCat = budgets.find(b => b.id === expenseForm.mainCategoryId);
                return mainCat ? mainCat.subCategories : [];
            };

            const getItemsForSubCategory = () => {
                if (!expenseForm.mainCategoryId || !expenseForm.subCategoryId) return [];
                const mainCat = budgets.find(b => b.id === expenseForm.mainCategoryId);
                if (!mainCat) return [];
                const subCat = mainCat.subCategories.find(s => s.id === expenseForm.subCategoryId);
                return subCat ? subCat.items : [];
            };

            if (!isSignedIn) {
                return (
                    <div className="container">
                        <div className="header">
                            <div className="header-left">
                                <h1>DBCC Budget Tracker</h1>
                                <p>Budget monitoring and expense tracking system</p>
                            </div>
                        </div>
                        <div className="card" style={{ textAlign: 'center', padding: '3rem' }}>
                            <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>üîê</div>
                            <h2 style={{ marginBottom: '1rem' }}>Sign In Required</h2>
                            <p style={{ color: '#6c757d', marginBottom: '2rem' }}>
                                Sign in with your Microsoft account to access the budget tracker
                            </p>
                            <button className="btn btn-primary" style={{ fontSize: '1.1rem', padding: '1rem 2rem' }} onClick={signIn}>
                                Sign in with Microsoft
                            </button>
                        </div>
                    </div>
                );
            }

            const stats = calculateStats();

            return (
                <div className="container">
                    <div className="header">
                        <div className="header-left">
                            <h1>DBCC Budget Tracker</h1>
                            <p>Budget monitoring and expense tracking system</p>
                        </div>
                        <div className="header-right">
                            <div className="budget-period-selector">
                                <span className="period-label">Period:</span>
                                {budgetPeriods.map(period => (
                                    <button
                                        key={period}
                                        className={`period-btn ${currentPeriod === period ? 'active' : ''}`}
                                        onClick={() => setCurrentPeriod(period)}
                                    >
                                        {period}
                                    </button>
                                ))}
                            </div>
                            <button className="btn btn-add-item" onClick={() => setShowAddItemModal(true)}>
                                + Add Budget Item
                            </button>
                            <button className="btn btn-secondary" onClick={openSetupNewYear}>
                                ‚öôÔ∏è Setup New Year
                            </button>
                            <button className="btn btn-secondary">
                                üìä Reports
                            </button>
                            <button className="btn btn-secondary" onClick={signOut}>
                                Sign Out
                            </button>
                        </div>
                    </div>

                    <div className="stats">
                        <div className="stat-card">
                            <div className="stat-label">Total Budget (FY {currentPeriod})</div>
                            <div className="stat-value">{formatCurrency(stats.totalBudget)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Total Spent</div>
                            <div className="stat-value">{formatCurrency(stats.totalSpent)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Remaining</div>
                            <div className="stat-value">{formatCurrency(stats.totalRemaining)}</div>
                        </div>
                    </div>

                    <div className="add-expense-section">
                        <div className="add-expense-section-left">
                            <h2>üí∞ Record an Expense</h2>
                            <p>Click to log a new expense against your budget</p>
                        </div>
                        <button className="btn btn-success" onClick={() => setShowExpenseModal(true)}>
                            + Add Expense
                        </button>
                    </div>

                    <div className="main-grid">
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Budget Categories</h3>
                            </div>

                            <div className="category-list">
                                {budgets.map(budget => {
                                    const percentage = (budget.spentAmount / budget.totalAmount) * 100;
                                    const remaining = budget.totalAmount - budget.spentAmount;
                                    const variance = remaining;
                                    const isExpanded = expandedCategory === budget.id;

                                    return (
                                        <div 
                                            key={budget.id} 
                                            className={`category-item ${isExpanded ? 'expanded' : ''}`}
                                            onClick={() => setExpandedCategory(isExpanded ? null : budget.id)}
                                        >
                                            <div className="category-header">
                                                <div className="category-name">
                                                    {budget.code} - {budget.name}
                                                </div>
                                                <div className="category-amount">
                                                    {formatCurrency(remaining)}
                                                </div>
                                            </div>
                                            <div className="category-progress">
                                                <div 
                                                    className={`category-progress-bar ${getProgressColor(percentage)}`}
                                                    style={{ width: `${Math.min(percentage, 100)}%` }}
                                                ></div>
                                            </div>
                                            <div className="category-stats">
                                                <span>Spent: {formatCurrency(budget.spentAmount)}</span>
                                                <span>{percentage.toFixed(1)}% used</span>
                                                <span className={variance >= 0 ? 'variance-positive' : 'variance-negative'}>
                                                    Variance: {formatCurrency(Math.abs(variance))}
                                                </span>
                                            </div>

                                            {isExpanded && budget.subCategories && budget.subCategories.length > 0 && (
                                                <div className="sub-categories" onClick={(e) => e.stopPropagation()}>
                                                    {budget.subCategories.map(subCat => {
                                                        const subPercentage = (subCat.spentAmount / subCat.totalAmount) * 100;
                                                        const subRemaining = subCat.totalAmount - subCat.spentAmount;
                                                        const isSubExpanded = expandedSubCategory === `${budget.id}-${subCat.id}`;

                                                        return (
                                                            <div 
                                                                key={subCat.id}
                                                                className={`sub-category-item ${isSubExpanded ? 'expanded' : ''}`}
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    setExpandedSubCategory(isSubExpanded ? null : `${budget.id}-${subCat.id}`);
                                                                }}
                                                            >
                                                                <div className="sub-category-header">
                                                                    <div className="sub-category-name">
                                                                        {subCat.code} - {subCat.name}
                                                                    </div>
                                                                    <div className="sub-category-amount">
                                                                        {formatCurrency(subRemaining)}
                                                                    </div>
                                                                </div>
                                                                <div className="sub-category-progress">
                                                                    <div 
                                                                        className={`sub-category-progress-bar ${getProgressColor(subPercentage)}`}
                                                                        style={{ width: `${Math.min(subPercentage, 100)}%` }}
                                                                    ></div>
                                                                </div>
                                                                <div className="sub-category-stats">
                                                                    Budget: {formatCurrency(subCat.totalAmount)} ‚Ä¢ 
                                                                    Spent: {formatCurrency(subCat.spentAmount)} ‚Ä¢ 
                                                                    {subPercentage.toFixed(1)}% used
                                                                </div>

                                                                {isSubExpanded && subCat.items && subCat.items.length > 0 && (
                                                                    <div className="level3-items" onClick={(e) => e.stopPropagation()}>
                                                                        {subCat.items.map((item) => {
                                                                            const itemRemaining = item.budget - item.spent;
                                                                            const itemPercentage = (item.spent / item.budget) * 100;
                                                                            
                                                                            return (
                                                                                <div key={item.id} className="item">
                                                                                    <div className="item-header">
                                                                                        <div className="item-name">{item.name}</div>
                                                                                        <div className="item-amount">{formatCurrency(itemRemaining)}</div>
                                                                                    </div>
                                                                                    <div className="item-stats">
                                                                                        <span>Budget: {formatCurrency(item.budget)}</span>
                                                                                        <span>Spent: {formatCurrency(item.spent)}</span>
                                                                                        <span>{itemPercentage.toFixed(1)}% used</span>
                                                                                    </div>
                                                                                    {item.notes && (
                                                                                        <div className="item-notes-full">
                                                                                            <strong>Notes:</strong> {item.notes}
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Recent Activity</h3>
                            </div>

                            {activities.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-state-icon">üìù</div>
                                    <p>No expenses recorded yet</p>
                                </div>
                            ) : (
                                <div className="activity-log">
                                    {activities.map(activity => (
                                        <div key={activity.id} className="activity-item">
                                            <div className="activity-header">
                                                <span className="activity-user">{activity.userName}</span>
                                                <span className="activity-time">{formatTime(activity.timestamp)}</span>
                                            </div>
                                            <div className="activity-category">
                                                {activity.mainCategory} ‚Üí {activity.subCategory}
                                            </div>
                                            <div className="activity-description">
                                                {activity.type === 'deletion' ? (
                                                    <span style={{ color: '#ef4444', fontStyle: 'italic' }}>
                                                        üóëÔ∏è Deleted: {activity.item} (by {activity.deletedBy})
                                                    </span>
                                                ) : (
                                                    activity.item
                                                )}
                                            </div>
                                            <div className="activity-amount">
                                                -{formatCurrency(activity.amount)}
                                            </div>
                                            {activity.type !== 'deletion' && (
                                                <div className="activity-actions">
                                                    <button 
                                                        className="btn btn-delete"
                                                        onClick={() => handleDeleteRecord(activity.id)}
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {showExpenseModal && (
                        <div className="modal" onClick={() => setShowExpenseModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3 className="modal-title">Record Expense</h3>
                                </div>
                                <form onSubmit={handleAddExpense}>
                                    <div className="form-group">
                                        <label className="form-label">Your Name</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Enter your name"
                                            value={expenseForm.userName}
                                            onChange={(e) => setExpenseForm({...expenseForm, userName: e.target.value})}
                                            required
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Main Category (Level 1)</label>
                                        <select
                                            className="form-select"
                                            value={expenseForm.mainCategoryId || ''}
                                            onChange={(e) => {
                                                const catId = parseInt(e.target.value);
                                                const cat = budgets.find(b => b.id === catId);
                                                setExpenseForm({
                                                    ...expenseForm, 
                                                    mainCategoryId: catId,
                                                    mainCategory: cat ? `${cat.code} - ${cat.name}` : '',
                                                    subCategoryId: null,
                                                    subCategory: '',
                                                    item: ''
                                                });
                                            }}
                                            required
                                        >
                                            <option value="">Select main category</option>
                                            {budgets.map(budget => (
                                                <option key={budget.id} value={budget.id}>
                                                    {budget.code} - {budget.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    {getSubCategoriesForMain().length > 0 && (
                                        <div className="form-group">
                                            <label className="form-label">Sub-Category (Level 2)</label>
                                            <select
                                                className="form-select"
                                                value={expenseForm.subCategoryId || ''}
                                                onChange={(e) => {
                                                    const subCatId = parseInt(e.target.value);
                                                    const subCat = getSubCategoriesForMain().find(s => s.id === subCatId);
                                                    setExpenseForm({
                                                        ...expenseForm, 
                                                        subCategoryId: subCatId,
                                                        subCategory: subCat ? `${subCat.code} - ${subCat.name}` : '',
                                                        item: ''
                                                    });
                                                }}
                                                required
                                            >
                                                <option value="">Select sub-category</option>
                                                {getSubCategoriesForMain().map(subCat => (
                                                    <option key={subCat.id} value={subCat.id}>
                                                        {subCat.code} - {subCat.name}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    )}

                                    {getItemsForSubCategory().length > 0 && (
                                        <div className="form-group">
                                            <label className="form-label">Specific Item (Level 3)</label>
                                            <select
                                                className="form-select"
                                                value={expenseForm.item}
                                                onChange={(e) => setExpenseForm({...expenseForm, item: e.target.value})}
                                                required
                                            >
                                                <option value="">Select specific item</option>
                                                {getItemsForSubCategory().map((item) => (
                                                    <option key={item.id} value={item.name}>
                                                        {item.name}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    )}

                                    <div className="form-group">
                                        <label className="form-label">Description</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="What was this expense for?"
                                            value={expenseForm.description}
                                            onChange={(e) => setExpenseForm({...expenseForm, description: e.target.value})}
                                            required
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Amount (Pula)</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            className="form-input"
                                            placeholder="0.00"
                                            value={expenseForm.amount}
                                            onChange={(e) => setExpenseForm({...expenseForm, amount: e.target.value})}
                                            required
                                        />
                                    </div>

                                    <div className="modal-actions">
                                        <button 
                                            type="button" 
                                            className="btn btn-secondary" 
                                            onClick={() => setShowExpenseModal(false)}
                                        >
                                            Cancel
                                        </button>
                                        <button 
                                            type="submit" 
                                            className="btn btn-primary"
                                            disabled={!expenseForm.mainCategoryId || !expenseForm.subCategoryId || (getItemsForSubCategory().length > 0 && !expenseForm.item)}
                                        >
                                            Record Expense
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {showSetupModal && (
                        <div className="modal" onClick={() => setShowSetupModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '800px', maxHeight: '90vh' }}>
                                <div className="modal-header">
                                    <h3 className="modal-title">Setup New Fiscal Year</h3>
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">New Fiscal Year</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="e.g., 2025-26"
                                        value={newFiscalYear}
                                        onChange={(e) => setNewFiscalYear(e.target.value)}
                                    />
                                </div>

                                <p style={{ color: '#6c757d', marginBottom: '1rem', fontSize: '0.9rem' }}>
                                    Below is your current budget structure. You can edit amounts, delete items, or add new ones. 
                                    Click "Create New Year" when ready.
                                </p>

                                <div style={{ maxHeight: '400px', overflowY: 'auto', border: '1px solid #e9ecef', borderRadius: '8px', padding: '1rem' }}>
                                    {setupYearData.map((mainCat) => (
                                        <div key={mainCat.id} style={{ marginBottom: '1.5rem', padding: '1rem', background: '#f8f9fa', borderRadius: '8px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.75rem' }}>
                                                <strong style={{ color: '#1e40af' }}>{mainCat.code} - {mainCat.name}</strong>
                                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                                    <input
                                                        type="number"
                                                        value={mainCat.totalAmount}
                                                        onChange={(e) => updateSetupBudgetAmount(mainCat.id, null, null, e.target.value)}
                                                        className="setup-budget-input"
                                                    />
                                                    <button
                                                        onClick={() => deleteSetupItem(mainCat.id, null, null)}
                                                        className="setup-delete-btn"
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>

                                            {mainCat.subCategories && mainCat.subCategories.map((subCat) => (
                                                <div key={subCat.id} style={{ marginLeft: '1rem', marginBottom: '1rem', padding: '0.75rem', background: 'white', borderRadius: '6px' }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                                                        <span style={{ fontWeight: '600', fontSize: '0.95rem' }}>{subCat.code} - {subCat.name}</span>
                                                        <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                                            <input
                                                                type="number"
                                                                value={subCat.totalAmount}
                                                                onChange={(e) => updateSetupBudgetAmount(mainCat.id, subCat.id, null, e.target.value)}
                                                                style={{ width: '130px', padding: '0.4rem', border: '1px solid #e9ecef', borderRadius: '4px', fontSize: '0.9rem' }}
                                                            />
                                                            <button
                                                                onClick={() => deleteSetupItem(mainCat.id, subCat.id, null)}
                                                                style={{ padding: '0.4rem 0.6rem', background: '#fff', border: '1px solid #ef4444', color: '#ef4444', borderRadius: '4px', cursor: 'pointer', fontSize: '0.85rem' }}
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>

                                                    {subCat.items && subCat.items.map((item) => (
                                                        <div key={item.id} style={{ marginLeft: '1rem', marginTop: '0.5rem', padding: '0.5rem', background: '#f8f9fa', borderRadius: '4px', fontSize: '0.9rem' }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                <span style={{ flex: 1 }}>{item.name}</span>
                                                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                                                    <input
                                                                        type="number"
                                                                        value={item.budget}
                                                                        onChange={(e) => updateSetupBudgetAmount(mainCat.id, subCat.id, item.id, e.target.value)}
                                                                        style={{ width: '110px', padding: '0.3rem', border: '1px solid #e9ecef', borderRadius: '4px', fontSize: '0.85rem' }}
                                                                    />
                                                                    <button
                                                                        onClick={() => deleteSetupItem(mainCat.id, subCat.id, item.id)}
                                                                        style={{ padding: '0.3rem 0.5rem', background: '#fff', border: '1px solid #ef4444', color: '#ef4444', borderRadius: '4px', cursor: 'pointer', fontSize: '0.8rem' }}
                                                                    >
                                                                        üóëÔ∏è
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            {item.notes && (
                                                                <div style={{ marginTop: '0.25rem', fontSize: '0.8rem', color: '#6c757d', fontStyle: 'italic' }}>
                                                                    Note: {item.notes}
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            ))}
                                        </div>
                                    ))}
                                </div>

                                <div className="modal-actions" style={{ marginTop: '1.5rem' }}>
                                    <button 
                                        type="button" 
                                        className="btn btn-secondary" 
                                        onClick={() => setShowSetupModal(false)}
                                    >
                                        Cancel
                                    </button>
                                    <button 
                                        type="button" 
                                        className="btn btn-primary"
                                        onClick={handleSetupYearSubmit}
                                    >
                                        Create New Year Budget
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showAddItemModal && (
                        <div className="modal" onClick={() => setShowAddItemModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3 className="modal-title">Add Budget Item</h3>
                                </div>
                                <form onSubmit={handleAddBudgetItem}>
                                    <div className="form-group">
                                        <label className="form-label">Item Level</label>
                                        <select
                                            className="form-select"
                                            value={addItemForm.level}
                                            onChange={(e) => setAddItemForm({...addItemForm, level: e.target.value, mainCategoryId: null, subCategoryId: null})}
                                            required
                                        >
                                            <option value="1">Level 1 - Main Category (e.g., A16)</option>
                                            <option value="2">Level 2 - Sub-Category (e.g., 3150)</option>
                                            <option value="3">Level 3 - Individual Item</option>
                                        </select>
                                    </div>

                                    {(addItemForm.level === '2' || addItemForm.level === '3') && (
                                        <div className="form-group">
                                            <label className="form-label">Parent Main Category</label>
                                            <select
                                                className="form-select"
                                                value={addItemForm.mainCategoryId || ''}
                                                onChange={(e) => setAddItemForm({...addItemForm, mainCategoryId: parseInt(e.target.value), subCategoryId: null})}
                                                required
                                            >
                                                <option value="">Select main category</option>
                                                {budgets.map(budget => (
                                                    <option key={budget.id} value={budget.id}>
                                                        {budget.code} - {budget.name}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    )}

                                    {addItemForm.level === '3' && addItemForm.mainCategoryId && (
                                        <div className="form-group">
                                            <label className="form-label">Parent Sub-Category</label>
                                            <select
                                                className="form-select"
                                                value={addItemForm.subCategoryId || ''}
                                                onChange={(e) => setAddItemForm({...addItemForm, subCategoryId: parseInt(e.target.value)})}
                                                required
                                            >
                                                <option value="">Select sub-category</option>
                                                {budgets.find(b => b.id === addItemForm.mainCategoryId)?.subCategories.map(subCat => (
                                                    <option key={subCat.id} value={subCat.id}>
                                                        {subCat.code} - {subCat.name}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    )}

                                    <div className="form-group">
                                        <label className="form-label">Code {addItemForm.level === '3' ? '(optional)' : '(required)'}</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder={addItemForm.level === '1' ? 'e.g., A17' : addItemForm.level === '2' ? 'e.g., 3180' : 'Leave blank for Level 3'}
                                            value={addItemForm.code}
                                            onChange={(e) => setAddItemForm({...addItemForm, code: e.target.value})}
                                            required={addItemForm.level !== '3'}
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Name</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Enter item name"
                                            value={addItemForm.name}
                                            onChange={(e) => setAddItemForm({...addItemForm, name: e.target.value})}
                                            required
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Budget Amount (Pula)</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            className="form-input"
                                            placeholder="0.00"
                                            value={addItemForm.budget}
                                            onChange={(e) => setAddItemForm({...addItemForm, budget: e.target.value})}
                                            required
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Notes (optional)</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Add any relevant notes"
                                            value={addItemForm.notes}
                                            onChange={(e) => setAddItemForm({...addItemForm, notes: e.target.value})}
                                        />
                                    </div>

                                    <div className="modal-actions">
                                        <button 
                                            type="button" 
                                            className="btn btn-secondary" 
                                            onClick={() => setShowAddItemModal(false)}
                                        >
                                            Cancel
                                        </button>
                                        <button type="submit" className="btn btn-primary">
                                            Add Budget Item
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {notification && (
                        <div className="notification">
                            {notification}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<BudgetTrackerApp />, document.getElementById('root'));
    </script>
</body>
</html>
